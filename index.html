<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<meta name="theme-color" content="#121213" />
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="manifest" href="manifest.webmanifest">
<title>LostWordle üçª</title>

<style>
:root{
  --bg:#121213;
  --key:#818384;
  --green:#538d4e;
  --yellow:#b59f3b;
  --grey:#3a3a3c;

  --tile: clamp(42px, 10vw, 52px);
  --gap: 4px;
  --key-h: clamp(44px, 10.5vw, 56px);
  --key-w: clamp(28px, 7.2vw, 38px);
  --key-font: clamp(12px, 3.6vw, 16px);
}

*{box-sizing:border-box;}
html,body{
  margin:0;height:100%;
  background:var(--bg);color:#fff;
  font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial;
  overflow:hidden;
  -webkit-tap-highlight-color: transparent;
}

.app{
  height:100svh;
  display:flex;
  flex-direction:column;
  padding-top:env(safe-area-inset-top);
  padding-bottom:env(safe-area-inset-bottom);
}

.header{text-align:center;padding:10px;border-bottom:1px solid #2a2a2c;}
.title{margin:0;font-size:28px;font-weight:800;}
.sub{margin-top:6px;font-size:12px;color:#bdbdbd;font-weight:700;}

.main{flex:1;display:flex;align-items:center;justify-content:center;}
.grid{display:flex;flex-direction:column;gap:var(--gap);}
.row{display:flex;gap:var(--gap);}

.tile{
  width:var(--tile);height:var(--tile);
  border:2px solid #3a3a3c;
  display:flex;align-items:center;justify-content:center;
  font-size:26px;font-weight:900;
}
.correct{background:var(--green);border-color:var(--green);}
.present{background:var(--yellow);border-color:var(--yellow);}
.absent{background:var(--grey);border-color:var(--grey);}

.footer{padding:8px 10px;}
.status{text-align:center;font-size:14px;font-weight:700;min-height:18px;}
.expiry{text-align:center;font-weight:800;margin:6px 0 8px;}

.kb{display:flex;flex-direction:column;gap:6px;}
.kbrow{display:flex;justify-content:center;gap:6px;}
.key{
  height:var(--key-h);
  min-width:var(--key-w);
  padding:0 8px;
  border-radius:8px;
  background:var(--key);
  font-weight:900;
  font-size:var(--key-font);
  display:flex;align-items:center;justify-content:center;
  user-select:none;
}
.key.wide{min-width:calc(var(--key-w)*1.6);}
.key.green{background:var(--green);}
.key.yellow{background:var(--yellow);}
.key.grey{background:var(--grey);}

.rules{text-align:center;font-size:10px;color:#8c8c8c;margin-top:10px;}
</style>
</head>

<body>
<div class="app">
  <div class="header">
    <div class="title">LostWordle üçª</div>
    <div class="sub" id="sub"></div>
  </div>

  <div class="main">
    <div class="grid" id="grid"></div>
  </div>

  <div class="footer">
    <div class="status" id="status"></div>
    <div class="expiry" id="expiry"></div>

    <div class="kb" id="kb"></div>
    <div class="rules">grey = 2 sips ‚Ä¢ yellow = 1 sip ‚Ä¢ green = 0 sips</div>
  </div>
</div>

<script>
/* ========= CONFIG ========= */
const WORD_LEN = 5;
const MAX_TRIES = 6;

// GMT+11 day rollover (Sydney festival time)
const OFFSET_MINUTES = 11 * 60;
const OFFSET_MS = OFFSET_MINUTES * 60 * 1000;
const DAY_MS = 86400000;

// Day 1 should be 27/12/2025 00:00 (GMT+11)
// That is 26/12/2025 13:00 UTC
const START_UTC_MS = Date.UTC(2025, 11, 26, 13, 0, 0);

// 6 daily words (Day 1..Day 6)
const WORDS = ["GLYPH","QUELL","COVEN","WRAITH","PSALM","VEXED"];

// Drinking rules
const SIP = { correct:0, present:1, absent:2 };

/* ========= GMT+11 DAY INDEX (CORRECT) =========
We convert any UTC timestamp into a "day number in GMT+11" by adding OFFSET_MS
then taking floor(ms / DAY_MS). This makes rollover happen at midnight GMT+11.
*/
const START_DAYNUM = Math.floor((START_UTC_MS + OFFSET_MS) / DAY_MS);

function dayIndexNow(){
  const nowUTC = Date.now();
  const nowDayNum = Math.floor((nowUTC + OFFSET_MS) / DAY_MS);
  return nowDayNum - START_DAYNUM; // 0 = Day 1
}

/* ========= STATE ========= */
let dayIndex = 0;          // 0-based index into WORDS
let secret = "";
let current = "";
let guesses = [];
let sipTotal = 0;
let gameOver = false;
const keyState = {};       // letter -> "green"|"yellow"|"grey"

const grid = document.getElementById("grid");
const kb = document.getElementById("kb");
const sub = document.getElementById("sub");
const status = document.getElementById("status");
const expiry = document.getElementById("expiry");

/* ========= GAME ========= */
function loadForToday(){
  dayIndex = dayIndexNow();
  secret = WORDS[dayIndex] || "";
  guesses = [];
  current = "";
  sipTotal = 0;
  gameOver = !secret;

  for(const k in keyState) delete keyState[k];

  status.textContent = "";
  expiry.textContent = secret
    ? `Day ${dayIndex+1} ‚Ä¢ expires 11:59pm (GMT+11)`
    : "No word today";

  render();
}

function score(g){
  const r = Array(WORD_LEN).fill("absent");
  const s = secret.split("");
  const used = {};

  g.split("").forEach((c,i)=>{
    if(c===s[i]) r[i]="correct";
    else used[s[i]] = (used[s[i]]||0) + 1;
  });

  g.split("").forEach((c,i)=>{
    if(r[i]==="correct") return;
    if(used[c]){
      r[i]="present";
      used[c]--;
    }
  });

  return r;
}

function updateKeys(g, r){
  // priority: green > yellow > grey
  r.forEach((res, i) => {
    const c = g[i];
    if(res==="correct") keyState[c]="green";
    else if(res==="present" && keyState[c] !== "green") keyState[c]="yellow";
    else if(!keyState[c]) keyState[c]="grey";
  });
}

function submit(){
  if(gameOver || current.length !== WORD_LEN) return;

  const res = score(current);
  updateKeys(current, res);

  sipTotal += res.reduce((sum, v) => sum + SIP[v], 0);
  guesses.push({ word: current, res });
  current = "";
  render();

  const won = res.every(v => v === "correct");
  const lost = guesses.length >= MAX_TRIES;

  if(won || lost){
    gameOver = true;
    status.textContent = won ? "üéâ Correct!" : `‚ùå Word was ${secret}`;
    setTimeout(()=>alert(`üçª DRINK UP\n\nTake ${sipTotal} sip${sipTotal===1?"":"s"}`), 50);
  }
}

function tap(k){
  if(gameOver) return;
  if(k === "ENTER") submit();
  else if(k === "DEL") current = current.slice(0, -1);
  else if(current.length < WORD_LEN) current += k;
  render();
}

function render(){
  sub.textContent = secret
    ? `Day ${dayIndex+1} ‚Ä¢ Total sips: ${sipTotal}`
    : `No word today ‚Ä¢ Total sips: ${sipTotal}`;

  // Grid
  grid.innerHTML = "";
  for(let r=0; r<MAX_TRIES; r++){
    const row = document.createElement("div");
    row.className = "row";

    const g = guesses[r]?.word || "";
    const res = guesses[r]?.res || [];
    const disp = (r === guesses.length) ? current : g;

    for(let c=0; c<WORD_LEN; c++){
      const t = document.createElement("div");
      t.className = "tile " + (res[c] || "");
      t.textContent = disp[c] || "";
      row.appendChild(t);
    }
    grid.appendChild(row);
  }

  // Keyboard
  kb.innerHTML = "";
  ["QWERTYUIOP","ASDFGHJKL","ZXCVBNM"].forEach((row, i) => {
    const r = document.createElement("div");
    r.className = "kbrow";

    if(i === 2){
      const e = document.createElement("div");
      e.className = "key wide";
      e.textContent = "ENTER";
      e.onclick = () => tap("ENTER");
      r.appendChild(e);
    }

    row.split("").forEach(ch => {
      const k = document.createElement("div");
      k.className = "key " + (keyState[ch] || "");
      k.textContent = ch;
      k.onclick = () => tap(ch);
      r.appendChild(k);
    });

    if(i === 2){
      const d = document.createElement("div");
      d.className = "key wide";
      d.textContent = "DEL";
      d.onclick = () => tap("DEL");
      r.appendChild(d);
    }

    kb.appendChild(r);
  });
}

/* ========= AUTO ROLLOVER ========= */
setInterval(()=>{
  const idx = dayIndexNow();
  if(idx !== dayIndex){
    loadForToday();
  }
}, 10000);

loadForToday();

/* ========= OFFLINE ========= */
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("./sw.js").catch(()=>{});
}
</script>
</body>
</html>

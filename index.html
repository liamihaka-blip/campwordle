<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<meta name="theme-color" content="#121213" />
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="manifest" href="manifest.webmanifest">
<title>LostWordle üçª</title>

<style>
:root{
  --bg:#121213;
  --key:#818384;
  --green:#538d4e;
  --yellow:#b59f3b;
  --grey:#3a3a3c;

  --tile: clamp(42px, 10vw, 52px);
  --gap: 4px;
  --key-h: clamp(44px, 10.5vw, 56px);
  --key-w: clamp(28px, 7.2vw, 38px);
  --key-font: clamp(12px, 3.6vw, 16px);
}

*{box-sizing:border-box;}
html,body{
  margin:0;height:100%;
  background:var(--bg);color:#fff;
  font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial;
  overflow:hidden;
}

.app{
  height:100svh;
  display:flex;
  flex-direction:column;
  padding-top:env(safe-area-inset-top);
  padding-bottom:env(safe-area-inset-bottom);
}

.header{text-align:center;padding:10px;border-bottom:1px solid #2a2a2c;}
.title{margin:0;font-size:28px;font-weight:800;}
.sub{margin-top:6px;font-size:12px;color:#bdbdbd;font-weight:700;}

.main{flex:1;display:flex;align-items:center;justify-content:center;}
.grid{display:flex;flex-direction:column;gap:var(--gap);}
.row{display:flex;gap:var(--gap);}

.tile{
  width:var(--tile);height:var(--tile);
  border:2px solid #3a3a3c;
  display:flex;align-items:center;justify-content:center;
  font-size:26px;font-weight:900;
}
.correct{background:var(--green);border-color:var(--green);}
.present{background:var(--yellow);border-color:var(--yellow);}
.absent{background:var(--grey);border-color:var(--grey);}

.footer{padding:8px 10px;}
.status{text-align:center;font-size:14px;font-weight:700;min-height:18px;}
.expiry{text-align:center;font-weight:800;margin:6px 0 8px;}

.kb{display:flex;flex-direction:column;gap:6px;}
.kbrow{display:flex;justify-content:center;gap:6px;}
.key{
  height:var(--key-h);
  min-width:var(--key-w);
  padding:0 8px;
  border-radius:8px;
  background:var(--key);
  font-weight:900;
  display:flex;align-items:center;justify-content:center;
}
.key.wide{min-width:calc(var(--key-w)*1.6);}
.key.green{background:var(--green);}
.key.yellow{background:var(--yellow);}
.key.grey{background:var(--grey);}

.rules{text-align:center;font-size:10px;color:#8c8c8c;margin-top:10px;}
</style>
</head>

<body>
<div class="app">
  <div class="header">
    <div class="title">LostWordle üçª</div>
    <div class="sub" id="sub"></div>
  </div>

  <div class="main">
    <div class="grid" id="grid"></div>
  </div>

  <div class="footer">
    <div class="status" id="status"></div>
    <div class="expiry" id="expiry"></div>

    <div class="kb" id="kb"></div>
    <div class="rules">grey = 2 sips ‚Ä¢ yellow = 1 sip ‚Ä¢ green = 0 sips</div>
  </div>
</div>

<script>
/* ========= CONFIG ========= */
const WORD_LEN = 5;
const MAX_TRIES = 6;

// Day 1 = 27/12/2024 at 00:00 GMT+11 ‚Üí 26/12 13:00 UTC
const START_UTC = Date.UTC(2024, 11, 26, 13, 0, 0);

const WORDS = ["GLYPH","QUELL","COVEN","WRAITH","PSALM","VEXED"];
const SIP = { correct:0, present:1, absent:2 };

/* ========= DATE LOGIC (CORRECT) ========= */
function dayIndexNow(){
  const nowUTC = Date.now();
  return Math.floor((nowUTC - START_UTC) / (86400000));
}

/* ========= STATE ========= */
let dayIndex = dayIndexNow();
let secret = "";
let current = "";
let guesses = [];
let sipTotal = 0;
let gameOver = false;
const keyState = {};

const grid = document.getElementById("grid");
const kb = document.getElementById("kb");
const sub = document.getElementById("sub");
const status = document.getElementById("status");
const expiry = document.getElementById("expiry");

/* ========= GAME ========= */
function loadForToday(){
  dayIndex = dayIndexNow();
  secret = WORDS[dayIndex] || "";
  guesses=[]; current=""; sipTotal=0; gameOver=!secret;
  for(const k in keyState) delete keyState[k];

  expiry.textContent = secret
    ? `Day ${dayIndex+1} ‚Ä¢ expires 11:59pm`
    : "No word today";

  render();
}

function score(g){
  const r = Array(5).fill("absent");
  const s = secret.split("");
  const used = {};
  g.split("").forEach((c,i)=>c===s[i]?r[i]="correct":used[s[i]]=(used[s[i]]||0)+1);
  g.split("").forEach((c,i)=>{if(r[i]!=="correct" && used[c]){r[i]="present";used[c]--;}});
  return r;
}

function updateKeys(g,r){
  r.forEach((res,i)=>{
    const c=g[i];
    if(res==="correct") keyState[c]="green";
    else if(res==="present" && keyState[c]!=="green") keyState[c]="yellow";
    else if(!keyState[c]) keyState[c]="grey";
  });
}

function submit(){
  if(gameOver || current.length!==5) return;
  const res=score(current);
  updateKeys(current,res);
  sipTotal+=res.reduce((a,v)=>a+SIP[v],0);
  guesses.push({word:current,res});
  current="";
  render();

  if(res.every(v=>v==="correct") || guesses.length>=6){
    gameOver=true;
    status.textContent=res.every(v=>v==="correct")?"üéâ Correct!":`‚ùå Word was ${secret}`;
    setTimeout(()=>alert(`üçª DRINK UP\n\nTake ${sipTotal} sip${sipTotal===1?"":"s"}`),50);
  }
}

function tap(k){
  if(gameOver) return;
  if(k==="ENTER") submit();
  else if(k==="DEL") current=current.slice(0,-1);
  else if(current.length<5) current+=k;
  render();
}

function render(){
  sub.textContent=`Day ${dayIndex+1} ‚Ä¢ Total sips: ${sipTotal}`;
  grid.innerHTML="";
  for(let r=0;r<6;r++){
    const row=document.createElement("div");row.className="row";
    const g=guesses[r]?.word||"", res=guesses[r]?.res||[];
    const disp=r===guesses.length?current:g;
    for(let c=0;c<5;c++){
      const t=document.createElement("div");
      t.className="tile "+(res[c]||"");
      t.textContent=disp[c]||"";
      row.appendChild(t);
    }
    grid.appendChild(row);
  }

  kb.innerHTML="";
  ["QWERTYUIOP","ASDFGHJKL","ZXCVBNM"].forEach((row,i)=>{
    const r=document.createElement("div");r.className="kbrow";
    if(i===2){const e=document.createElement("div");e.className="key wide";e.textContent="ENTER";e.onclick=()=>tap("ENTER");r.appendChild(e);}
    row.split("").forEach(ch=>{
      const k=document.createElement("div");
      k.className="key "+(keyState[ch]||"");
      k.textContent=ch;k.onclick=()=>tap(ch);r.appendChild(k);
    });
    if(i===2){const d=document.createElement("div");d.className="key wide";d.textContent="DEL";d.onclick=()=>tap("DEL");r.appendChild(d);}
    kb.appendChild(r);
  });
}

/* rollover check */
setInterval(()=>{
  const idx=dayIndexNow();
  if(idx!==dayIndex) loadForToday();
},10000);

loadForToday();

if("serviceWorker"in navigator){
  navigator.serviceWorker.register("./sw.js").catch(()=>{});
}
</script>
</body>
</html>

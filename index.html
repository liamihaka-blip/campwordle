<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#121213" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <link rel="manifest" href="manifest.webmanifest">
  <title>LostWordle üçª</title>

  <style>
    body{
      margin:0;
      background:#121213;
      color:#fff;
      font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial;
      overscroll-behavior:none;
    }
    .wrap{
      max-width:420px;
      margin:0 auto;
      padding:8px 10px env(safe-area-inset-bottom);
      text-align:center;
    }
    h1{ margin:6px 0 4px; font-size:26px; }
    .sub{ color:#bdbdbd; font-size:11px; font-weight:700; margin-bottom:6px; }
    .grid{ display:inline-block; margin-top:4px; }
    .row{ display:flex; justify-content:center; }
    .tile{
      width:46px; height:46px; margin:3px;
      border:2px solid #3a3a3c;
      display:flex; align-items:center; justify-content:center;
      font-size:24px; font-weight:800; box-sizing:border-box;
    }
    .empty{background:#121213}
    .correct{background:#538d4e;border-color:#538d4e}
    .present{background:#b59f3b;border-color:#b59f3b}
    .absent{background:#3a3a3c;border-color:#3a3a3c}

    .kb{ margin-top:8px; }
    .kbrow{ display:flex; justify-content:center; }
    .key{
      background:#818384; color:#fff; font-weight:800;
      border-radius:4px; margin:3px;
      padding:12px 8px; min-width:28px; font-size:14px;
      user-select:none;
    }
    .wide{ padding:12px 14px; }

    .status{ margin-top:6px; font-weight:700; font-size:14px; padding:0 10px; min-height:18px; }
    .rules{ margin-top:6px; color:#8c8c8c; font-size:10px; font-weight:700; }
    .btnRow{ display:flex; justify-content:center; gap:8px; margin-top:6px; flex-wrap:wrap; }
    .btn{
      display:inline-block;
      background:#2a2a2c;
      border:1px solid #3a3a3c;
      border-radius:8px;
      padding:8px 12px;
      font-weight:900;
      font-size:12px;
    }
  </style>
</head>
<body>
<div class="wrap">
  <h1>LostWordle üçª</h1>
  <div class="sub" id="sub"></div>

  <div class="grid" id="grid"></div>
  <div class="kb" id="kb"></div>

  <div class="status" id="status"></div>

  <div class="btnRow">
    <div class="btn" id="newRound">NEW ROUND (same day)</div>
  </div>

  <div class="rules">Rules: grey = 2 sips ‚Ä¢ yellow = 1 sip ‚Ä¢ green = 0 sips</div>
</div>

<script>
/* ========= CONFIG ========= */
const WORD_LEN = 5;
const MAX_TRIES = 6;

// GMT+11
const FESTIVAL_UTC_OFFSET_MINUTES = 11 * 60;

// Harder daily words (Day 1 = today). All 5 letters.
const FESTIVAL_WORDS = ["GLYPH","QUELL","COVEN","WRAITH","PSALM","VEXED"];

// Drinking rules
const SIP_VALUES = { correct:0, present:1, absent:2 };

/* ========= TIME (GMT+11) ========= */
function festivalNow(){
  const now=new Date();
  const utcMs=now.getTime()+now.getTimezoneOffset()*60000;
  return new Date(utcMs + FESTIVAL_UTC_OFFSET_MINUTES*60000);
}
function festivalMidnight(date=festivalNow()){
  const d=new Date(date); d.setHours(0,0,0,0); return d;
}
function calcDayIndex(startMidnight){
  const todayMid=festivalMidnight();
  const diff=todayMid.getTime()-startMidnight.getTime();
  return Math.floor(diff/(24*60*60*1000));
}

/* ========= STATE ========= */
const startMidnight = festivalMidnight();
let dayIndex = calcDayIndex(startMidnight);

let secret = "";
let guesses = []; // {word,result}
let current = "";
let sipTotal = 0;
let stage = "play";

const subEl = document.getElementById("sub");
const gridEl = document.getElementById("grid");
const kbEl = document.getElementById("kb");
const statusEl = document.getElementById("status");
const newRoundBtn = document.getElementById("newRound");

function onlyAZ(s){ return s.toUpperCase().replace(/[^A-Z]/g,""); }

function loadWordForDay(){
  secret = FESTIVAL_WORDS[dayIndex] || "";
  guesses = [];
  current = "";
  sipTotal = 0;
  stage = secret ? "play" : "done";
  render();
  statusEl.textContent = secret
    ? `Day ${dayIndex+1} word live ‚Ä¢ expires 11:59pm GMT+11`
    : `No word scheduled for today.`;
}

function scoreGuess(guess){
  const res = Array(WORD_LEN).fill("absent");
  const s = secret.split("");
  const g = guess.split("");
  const remaining = {};
  for(let i=0;i<WORD_LEN;i++){
    if(g[i]===s[i]) res[i]="correct";
    else remaining[s[i]]=(remaining[s[i]]||0)+1;
  }
  for(let i=0;i<WORD_LEN;i++){
    if(res[i]==="correct") continue;
    if((remaining[g[i]]||0)>0){
      res[i]="present";
      remaining[g[i]]--;
    }
  }
  return res;
}

function sipsForResult(result){
  return result.reduce((sum,r)=>sum+(SIP_VALUES[r]??0),0);
}

function submitGuess(){
  if(stage!=="play") return;
  if(current.length!==WORD_LEN) return;

  const guess = onlyAZ(current);

  const result = scoreGuess(guess);
  const guessSips = sipsForResult(result);
  sipTotal += guessSips;

  guesses.push({ word: guess, result });
  current = "";

  render();

  const won = result.every(r=>r==="correct");
  const lost = guesses.length>=MAX_TRIES;

  if(won || lost){
    stage="done";
    const msg = `You owe ${sipTotal} sip${sipTotal===1?"":"s"} üç∫`;
    setTimeout(()=>alert("üçª DRINK UP\n\n"+msg), 50);
    statusEl.textContent = won ? "üéâ Correct!" : `‚ùå Out of tries. Word was ${secret}`;
  } else {
    statusEl.textContent = `+${guessSips} sips ‚Ä¢ Total ${sipTotal}`;
  }
}

function tapKey(k){
  if(stage!=="play") return;
  if(k==="ENTER") submitGuess();
  else if(k==="DEL") current=current.slice(0,-1);
  else if(current.length<WORD_LEN) current=onlyAZ(current+k);
  render();
}

function render(){
  subEl.textContent = `Day ${dayIndex+1} ‚Ä¢ GMT+11 ‚Ä¢ Total sips: ${sipTotal}`;

  // Grid
  gridEl.innerHTML = "";
  for(let r=0;r<MAX_TRIES;r++){
    const row=document.createElement("div");
    row.className="row";
    const guess=guesses[r]?.word || "";
    const result=guesses[r]?.result || [];
    const display = (r===guesses.length) ? current : guess;

    for(let c=0;c<WORD_LEN;c++){
      const tile=document.createElement("div");
      tile.className="tile " + (result[c] ? result[c] : "empty");
      tile.textContent = display[c] || "";
      row.appendChild(tile);
    }
    gridEl.appendChild(row);
  }

  // Keyboard
  kbEl.innerHTML = "";
  const rows = ["QWERTYUIOP","ASDFGHJKL","ZXCVBNM"];
  rows.forEach((letters, i)=>{
    const r=document.createElement("div");
    r.className="kbrow";
    if(i===2){
      const enter=document.createElement("div");
      enter.className="key wide";
      enter.textContent="ENTER";
      enter.onclick=()=>tapKey("ENTER");
      r.appendChild(enter);
    }
    letters.split("").forEach(ch=>{
      const k=document.createElement("div");
      k.className="key";
      k.textContent=ch;
      k.onclick=()=>tapKey(ch);
      r.appendChild(k);
    });
    if(i===2){
      const del=document.createElement("div");
      del.className="key wide";
      del.textContent="DEL";
      del.onclick=()=>tapKey("DEL");
      r.appendChild(del);
    }
    kbEl.appendChild(r);
  });
}

newRoundBtn.onclick=()=>{
  if(!secret) return;
  guesses=[]; current=""; sipTotal=0; stage="play";
  statusEl.textContent = `Same word for Day ${dayIndex+1}. New round started.`;
  render();
};

// Day rollover at midnight (GMT+11)
setInterval(()=>{
  const newIdx = calcDayIndex(startMidnight);
  if(newIdx!==dayIndex){
    dayIndex=newIdx;
    loadWordForDay();
  }
}, 10000);

loadWordForDay();

// Register Service Worker for offline use
if("serviceWorker" in navigator){
  window.addEventListener("load", ()=>{
    navigator.serviceWorker.register("./sw.js").catch(()=>{});
  });
}
</script>
</body>
</html>
